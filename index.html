<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Vocablearner</title>
	<style>
		body {
			font-family: serif;
			text-align: center;
			margin: 50px;
		}
		#gword {
			margin-top: 20px;
			font-size: 24px;
			font-weight: bold;
			color: #00bb00;
		}
		#message {
			margin-top: 20px;
			font-size: 24px;
			font-weight: bold;
			color: #0000bb;
		}
		button {
			padding: 10px 20px;
			font-size: 18px;
			margin: 10px;
		}
		.hidden {
			display: none;
		}
	</style>
</head>
<body>

<h1>Vocablearner</h1>

<label for="lang">Language:</label>
<select id="lang">
	<option value="res/en-de.tsv">English - German</option>
	<option value="res/en-el.tsv">English - Greek</option>
	<option value="res/en-hu.tsv">English - Hungarian</option>
	<option value="res/en-ko.tsv">English - Korean</option>
	<option value="res/en-ro.tsv">English - Romanian</option>
</select>

<!-- interface -->
<button id="load">Load</button>
<button id="startgame" disabled>Start</button>
<button id="restart" class="hidden">Restart</button>

<div id="scorecount"></div>
<div id="gword"></div>
<div id="buttons" class="hidden">
	<button class="options">1</button>
	<button class="options">2</button>
	<button class="options">3</button>
	<button class="options">4</button>
</div>
<div id="message"></div>

<script>
	let show = 0;
	let score = 0;
	let words = [];

	// load the TSV dictionary
	async function loadTSV(url) {
		try {
			const response = await fetch(url);
			// Check if ok
			if (!response.ok) throw new Error("Could not load file.");

			// prepare text
			const text = await response.text();
			const lines = text.trim().split('\n');
			words = [];

			// Parsing
			lines.forEach(line => {
			// split by tabs (duh)
				const [word, def] = line.split('\t');
				words.push({ word, def});
			});
			
			// Enable the button after loading the file
			document.getElementById('startgame').disabled = false;
			document.getElementById('gword').textContent = 'Language ready! Have fun!';
			// Make buttons and text visible (only once)
			if (show === 0) {
				document.getElementById('buttons').classList.toggle('hidden');
				document.getElementById('restart').classList.toggle('hidden');
				document.getElementById('scorecount').textContent = `Score: ${score}`;
				show = 1;
			}
		} catch (error) {
			document.getElementById('gword').textContent = error.message;
		}
	}

	// Game loop
	function guesser() {
		if (words.length > 0) {
			const rnd = Math.floor(Math.random() * words.length);
			const dict = words[rnd];
			const pos = Math.floor(Math.random() * 4);

			document.getElementById('gword').textContent = dict.word;

			// Loop through option buttons
			const bt = document.querySelectorAll('.options');
			
			bt.forEach((btn, index) => {
				// display the correct word in random places
				if (index === pos) {
					btn.textContent = dict.def;
				} else {
					let rndindex;
					do {
						// choose another random word
						rndindex = Math.floor(Math.random() * words.length);
					} while (rndindex === rnd); // don't choose the same word
					btn.textContent = words[rndindex].def;
				}
				btn.onclick = () => checkword(index, pos);
			});
		} else {
			document.getElementById('gword').textContent = 'Choose and load a language first!';
		}
	}

	function checkword(index, pos) {
		if (index === pos) {
			score++;
			document.getElementById('message').textContent = `Correct! Score: ${score}`;
		} else {
			score--;
			document.getElementById('message').textContent = `Wrong! Score: ${score}`;
		}
		document.getElementById('scorecount').textContent = `Score: ${score}`;
		guesser();
	}

	// load a language
	document.getElementById('load').addEventListener('click', function() {
		const file = document.getElementById('lang').value;
		loadTSV(file);
	});

	// Game start
	document.getElementById('startgame').addEventListener('click', guesser);
	document.getElementById('restart').addEventListener('click', function() {
		score = 0;
		document.getElementById('scorecount').textContent = `Score: ${score}`;
		document.getElementById(`restart`).classList.add('hidden');
		guesser();
	});
</script>

</body>
</html>

